---
title: "Map visualization optimization techniques üó∫Ô∏è"
author: "Ra√∫l Jim√©nez Ortega | [@hhkaos](https://x.com/hhkaos)"
format: 
  revealjs:
    theme: [dark, custom.scss]
title-slide-attributes:
  data-background-image: ./imgs/intro-slide.png
  data-background-size: cover
  data-background-opacity: "0.5"
---



# Dataviz {.smallerTitle}

:::: {.columns}

::: {.column width="50%"}
![](./imgs/covid-map.png)
![](./imgs/mapa-rentas.gif)
:::

::: {.column width="50%"}
{{< video ./video/erupcion-la-palma-3.mp4 >}}
![](./imgs/mapa-sequia.png)
:::

::::


# &nbsp;{.center-title-slide}

::: {.center-xy}
![](./imgs/commit-conf-logo-white.png){width="250"}
:::

::: {.notes}
preguntar quien ha hecho una visualiz con +1000 datos en un mapa , +10.000, +100.000, ...
Quer√≠a contaros c√≥mo fue mi primera experiencia (o drama) que acontenci√≥ por estas fechas hacer 10 a√±os, marzo/abril de 2014. Nada m√°s empezar mi nuevo trabajo en Esri, se acerc√≥ mi jefe muy emocionado y me dijo... Ra√∫l, el responsable de marketing ha hablado con la gente de El Pa√≠s, el peri√≥dico, y vamos a hacer una Geoporra para la final de la Champions League del mes que viene (Madrid - Atl√©tico) ...
:::

## {background-video="./video/geoporra.mp4" background-size="contain"} 
<!-- {.center-title-slide .smallerTitle} -->

<!-- ::: {.center-xy}

{{< video https://www.youtube.com/embed/DF6XU5Rp9qk?si=7ZXrRYYBEEeRZh9Y  width="840" height="472">}}

::: -->


::: {.notes}
Montamos un servidor de mapas PostgreSQL
Final de la Champions League 
Yo nuevo en mapas, vamos a crear unos √≠ndices espaciales, postgres.... petaba

Bueno Peri√≥dico, p√°gina de clasificados, b2b, agencias
:::

<!-- ## 

[![Elecciones 2015 | Resolviendo la noche electoral con AWS + Node js + ..](./imgs/resolviendo-la-noche-electoral.png)](https://www.youtube.com/watch?v=XLcl-zQxwTo){width="550"}

::: {.notes}
Resultados electorales
Es relativamente frecuente que a las 8:31PM cuando se cierran las urnas y empieza el recuento de votos principales peri√≥dicos tengan cargas brutales y que se vengan abajo.
::: -->

<!-- ## Elecciones municipales 2019

[![Elecciones municipales](https://esri-es.github.io/arcgis-gifs/other/Votos%20rentas%20escuelas%20o%20turistas%20nueve%20mapas%20muy%20detallados%20de%202019%20elpais.gif)](https://elpais.com/politica/2019/12/30/actualidad/1577728404_034592.html){width="550"}

::: {.notes}
Periodista de datos
::: -->

# Ra√∫l Jim√©nez Ortega | [@hhkaos](https://x.com/hhkaos) {.smallerTitle}

::: {.incremental}

* From Nerja (M√°laga)‚òÄÔ∏è‚õ¥Ô∏è ; living in Almer√≠a üåµüòé
* Family guy üë®‚Äçüë©‚Äçüë¶‚Äçüë¶
* [Geek](https://www.rauljimenez.info/docs/about-me/my-journey) üë®üèª‚Äçüíª
* Product Engineer @ [Esri](https://developers.arcgis.com/) ü•ëüá∫üá∏
* 10 years running [GeoDevelopers.org](https://www.geodevelopers.org/) üó∫Ô∏èüåç

:::

![](./imgs/raul-jimenez.png){.absolute bottom=0 right=50 width="250"}

# What can we optimize? {.strongBg background-image="./imgs/chris-liverani-speedometer-unsplash.jpg"  background-size="cover"}

## 1. Initial loading times{.smallerTitle}

![](./imgs/initial-loading-time-comparison.gif){.fullWidth}

<!-- {{< video ./video/initial-loading-time-comparison.mp4 >}} -->

## 2. Fluency of interaction {.smallerTitle}

[![](./imgs/low-fps-rendering.gif){.nostretch fig-align="center"}](https://esridevevents.github.io/arcgis-platform-location-services-for-developers-2023/leaflet-geojson.html)

::: {.notes}
FPS
Visor web usando &lt;svg&gt; para pintar ~35K municipios de Francia <br/>(45MB de JSON; +2M v√©rtices)
:::

## 3. Costs{.smallerTitle}

![Basemap Pricing Models](./imgs/basemaps-pricing-models.png)

:::{.tiny}
> Watch: [Intro to base maps (ES)](https://www.youtube.com/watch?v=SBf8d6PeJMQ&t=613s)
:::

# TECHNOLOGIES {.strongBg background-image="./imgs/state-of-the-art-mapping.png"  background-size="cover"}

State of the art 

## Static maps {.smaller}

::: {.panel-tabset}

### Examples

{{< video ./video/static-maps-use-cases.mp4 >}}

### Code

[![](./imgs/static-map.jpg)](./imgs/static-map.jpg)


<!-- ### Cu√°ndo

* ‚úÖ **ADECUADO**
  * En listados, p√°ginas de alto tr√°fico, compartir en medios que no soportar formatos avanzados (redes sociales, correo, etc.), ...
  * Para mejorar la percepci√≥n de t¬∫ de carga inicial
* ‚ùå **DESACONSEJADO**
  * Cuando se necesita intereractuar/explorar el mapa -->

### Technologies

* [ArcGIS Print Service](https://developers.arcgis.com/javascript/latest/sample-code/widgets-print/) (_new API coming soon_)
* [Geoapify Static Maps API](https://www.geoapify.com/static-maps-api)
* [Google Map Static API](https://developers.google.com/maps/documentation/maps-static/overview)
* [Mapbox Static Images API](https://docs.mapbox.com/api/maps/static-images/)
* [MapTiler API](https://www.maptiler.com/cloud/static-maps/)
* [Mapquest Static Map API](https://developer.mapquest.com/documentation/api/static-map/)
* [Thunderforest Static Map API](https://www.thunderforest.com/docs/static-maps-api/)
* ...

::: {.notes}
Las posibilidades varian entre proveedores
:::

:::

## Dynamic maps {.smaller}x

::: {.panel-tabset}

### Example

<iframe src="/demos/amcharts-demo/dist/" style="width:100%;height:520px"></iframe>

### Code

[![](./imgs/svg-map.png)](./imgs/svg-map.png)

### Technologies

* [amCharts](https://www.amcharts.com/demos/#maps)
* [Charts.js](https://www.sgratzl.com/chartjs-chart-geo/examples/)
* [D3.js geo](https://observablehq.com/@d3/gallery#maps)
* [Highcharts](https://www.highcharts.com/demo#highcharts-maps-demo-general)
* [jVectorMap](https://jvectormap.com/examples/world-gdp/)
* [Leaflet](https://leafletjs.com/)
* [Raphael.js (mapael)](https://www.vincentbroute.fr/mapael/)
* [SimpleMaps](https://simplemaps.com/resources/svg-maps)
* ...



:::

## Interactive maps {.smaller}

::: {.notes}
usan una combinaci√≥n de canvas y SVG (Limitados a 2D. )
Hasta decenas de miles de puntos, cientos/miles de pol√≠gonos
combinar con herramientas de an√°lisis espacial en el cliente (filtros espaciales), etc.
Buscador de direcciones. Mayores extensiones. Todos permiten mapas de fondo, mapas sat√©lite, etc.
:::

::: {.panel-tabset}

### Example

{{< video ./video/ign-iberpix.mp4 >}}


### Code

![](./imgs/canvas2d-map.jpg)

### Technologies

* [ArcGIS JS SDK 3.x](https://developers.arcgis.com/javascript/3/) (_deprecated_)
* [Google Maps JavaScript API](https://developers.google.com/maps/documentation/javascript)
* [Leaflet](https://leafletjs.com/)<sup>*</sup>
* [OpenLayers](https://openlayers.org/)

:::

## Immersive maps {.smaller}

::: {.notes}
WebGL/OpenGL, mayor n√∫mero de elementos, efectos tipo photoshop,  personalizar cambiar el estilo del mapa, rotarlo, 3D,
:::

::: {.panel-tabset}

### Example

{{< video ./video/inmerse-dataviz.mp4 >}}

### Code

{{< video ./video/webgl-canvas.mp4 >}}

### Technologies

* [ArcGIS Maps SDK for JavaScript](https://js.arcgis.com/)
* [Azure Maps](https://samples.azuremaps.com/)
* [CesiumJS](https://cesium.com/platform/cesiumjs/)
* [Deck.gl](https://docs.carto.com/carto-for-developers/carto-for-deck.gl)
* [HERE](https://developer.here.com/develop/javascript-api)
* [Kepler.gl](https://kepler.gl/)
* [Mapbox GL JS](https://docs.mapbox.com/mapbox-gl-js/api/)
* [MapLibre GL JS](https://maplibre.org/maplibre-gl-js/docs/)
* [TomTom Maps SDK Web JS](https://developer.tomtom.com/maps-sdk-web-js/overview/product-information/introduction)

:::

##  {background-color="white" background-image="./imgs/map-types-comparison-IMGs-SVG-Canvas-WebGL.png"  background-size="contain"}

# LOAD TIMES{.strongBg background-image="./imgs/time-stopwatch.jpg"  background-size="cover"}

Optimizing _datasets_ of hundreds of thousands or millions of data and server response times

## Reduce _bytes_ sent over the network{.smaller}

![Ratio, compression and decompression time by algorithm | Source: OpenCPU](./imgs/algorithm-compression-ratios-opencpu.png)

## GeoJSON standard ([RFC 7946](https://datatracker.ietf.org/doc/html/rfc7946)){.smaller}

[![](./imgs/geojson-explained.png)](./imgs/geojson-explained.png)

## Reduce the size of the _dataset_{.smaller}

![Relationship between the number of decimals of a coordinate and precision](./imgs/geojson-decimal-precision-in-madrid.jpg)

:::{.tiny}
> And...of course [don't send properties you don't need, remove spaces, etc (uglify)](https://github.com/radical-data/reducegeojson)
:::

::: {.notes}
Las coordenadas GeoJSON suelen tener por defecto una precisi√≥n extrema, a menudo con 15-17 decimales, lo que equivale a una escala at√≥mica. Para la mayor√≠a de las aplicaciones pr√°cticas, se puede reducir la precisi√≥n de las coordenadas a unos 6 decimales, lo que equivale aproximadamente a una escala de 1 cm. Esto reduce el tama√±o del archivo sin comprometer la usabilidad.
:::

## Poligons or lines{.smaller}

::: {.panel-tabset}

### TopoJSON

[![](./imgs/topojson-explained.png)](./imgs/topojson-explained.png)

### Convert and simplify

<iframe src="https://mapshaper.org/" style="width:100%;height:520px"></iframe>

:::

## Chop the data{.smaller}

::: {.notes}
Data Chunking y visualizaciones sensibles a la escala
:::

::: {.panel-tabset}

### Tiling

![](./imgs/zoom-level-tiling.png)


### FeatureLayer

<iframe src="/demos/arcgis-tiles/arcgis-js-sdk-feature-layers.html"  style="width:100%;height:520px"></iframe>

### Vector

<iframe src="/demos/arcgis-tiles/arcgis-js-sdk-vt.html"  style="width:100%;height:520px"></iframe>

### Raster

<iframe src="/demos/arcgis-tiles/arcgis-js-sdk-raster.html"  style="width:100%;height:520px"></iframe>


### Technologies

* [ArcGIS Data Hosting](https://developers.arcgis.com/documentation/mapping-apis-and-services/data-hosting/)
* [GeoServer](http://geoserver.org/)
* [Koop](https://www.osgeo.org/projects/koop/)
* [Mapbox Tiling Service](https://www.mapbox.com/mts)
* [MapTiler GeoData Hosting](https://www.maptiler.com/cloud/geodata-hosting/)
* [MapServer](https://mapserver.org/)
* [Martin](https://github.com/maplibre/martin)
* [Tegola](https://github.com/go-spatial/tegola)

:::

## Cache as much as possible!

:::widthAutoCenter
![](./imgs/memory-cache-meme.gif)
:::

## Create spatial indexes{.smaller}

![](./imgs/spatial-index.jpg)



<!-- ## Streaming de datos -->


# FLUENCY OF INTERACTION {.strongBg background-image="./imgs/mike-lewis-headsmart-media-smooth-water-unsplash.jpg"  background-size="cover"}

* _Clustering_ üîç
* _Heatmaps_ üî•
* _Binning_ üì¶
* _Client-side analysis_ üìèüìê

::: {.notes}
Optimizar la renderizaci√≥n/pintado (webgl, renderers)
Reducir los tiempos de respuesta (usa la info en el browser)
Usa WebGL para grandes cantidades de datos
Mueve la m√°xima cantidad al cliente
:::

## Clustering üîç {.smaller}

:::{.notes}
para datos de tipo punto
:::

::: {.panel-tabset}

### Intro

{{< video ./video/before-after-clustering.mp4 >}}


### Predominant class

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurereduction-cluster-query/live/" style="width:100%;height:500px"></iframe>

### Statistics

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurereduction-cluster-filter-slider/live/" style="width:100%;height:500px"></iframe>

### Visual variables

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurereduction-cluster-visualvariables/live/" style="width:100%;height:500px"></iframe>

### Pie chart

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurereduction-cluster-pie-charts/live/" style="width:100%;height:500px"></iframe>

:::

## Heatmaps üî• {.smaller}

::: {.panel-tabset}

### Intro

[![](./imgs/heatmap.jpg)](https://www.esri.com/arcgis-blog/products/arcgis-online/mapping/next-generation-heat-maps-mapviewer/)


### Dynamic

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/visualization-heatmap-scale/live/" style="width:100%;height:500px"></iframe>

### Static

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/visualization-heatmap-static/live/" style="width:100%;height:500px"></iframe>

### 3D

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/visualization-heatmap-scene/live/" style="width:100%;height:500px"></iframe>

:::

## Binning üì¶  {.smaller}

::: {.panel-tabset}

### Intro

<iframe src="https://developers.arcgis.com/javascript/latest/demo-apps/visualization-demos-high-density-binning-swipe-2ddd3e70b27990d90548d6e62d91d373.html" style="width:100%;height:500px"></iframe>

### Simple

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurereduction-binning/live/" style="width:100%;height:500px"></iframe>

### Statistics

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurereduction-binning-arcade-summary/live/" style="width:100%;height:500px"></iframe>

:::

## Do as much as you can in the client {.smaller}

::: {.panel-tabset}

### Spatial analysis

<iframe src="https://developers.arcgis.com/documentation/demo-apps/mapping-apis-and-services-spatial-analysis-code-geometry-analysis-spatial-relationships-demo-33c89f5c18c7a540ad5332971a601900.html"  style="width:100%;height:500px"></iframe>

### Geometric calculations

<iframe src="https://developers.arcgis.com/documentation/demo-apps/mapping-apis-and-services-spatial-analysis-code-geometry-analysis-geometry-calculations-demo-df70d5868c1b40f881b95762d0af0d17.html"  style="width:100%;height:500px"></iframe>

### Statistics

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/featurelayerview-query-geometry/live/"  style="width:100%;height:500px"></iframe>

### Filter

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/layers-imagery-pixelvalues/live/"  style="width:100%;height:500px"></iframe>

### Pixel

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/layers-imagery-clientside/live/"  style="width:100%;height:500px"></iframe>

:::

:::{.notes}
usando blending
:::

# COSTS  {.strongBg background-image="./imgs/fabian-blank-costs.jpg"  background-size="cover"}

## Open data

* [amCharts geodata](https://www.amcharts.com/dl/amcharts5-geodata/)
* [ArcGIS Hub](hub.arcgis.com)
* [Open data from the Government of Spain](https://datos.gob.es/es/)
* [Free SVG Maps](https://www.amcharts.com/svg-maps/)
* [Spatial Data Infrastructures](https://en.wikipedia.org/wiki/Spatial_data_infrastructure) (e.g. [IGN](https://www.ign.es/web/cbg-area-cartografia))
* [OpenStreetMap](https://wiki.openstreetmap.org/)
* ...

## Dataviz

![](./imgs/BASEmap-vs-baseMAP.plates.png)

## Dataviz

![](./imgs/BASEmap-vs-baseMAP.maps.png)

##  {background-video="./video/protomaps.mp4" background-size="contain"}

<!-- {{< video ./video/protomaps.mp4 controls autoplay >}} -->

# CONCLUSIONS {.strongBg background-image="./imgs/victoriano-izquierdo-unsplash-conclusiones.jpg"  background-size="cover"}

## What is the best technology?

## What is the best technology?

It depends on the use case and the needs:

::: {.incremental}
* üé® Design / customization
* ü§è Interaction
* üì¶ Data types
* üì± Devices
* ‚è±Ô∏è Loading times
* üßë‚Äçü¶Ω Accessibility
* ...
:::


## If I could travel in time... { background-image=""  background-size="cover"}

I would:

::: {.incremental}
* Sliced using _feature layers_ (not images)
* Used clusters (not points)
* I would have used cache (_near real-time_)
* Statistics on the client (not server)
* Used protomaps
:::

![](./imgs/geoporra-travel-time.png){.absolute bottom=0 right=50 width="350"}

<!-- # Casos m√°s complejos 

Datos medioambientales

## Datos medioambientales {.smaller}

::: {.panel-tabset}

### Multimedia

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/layers-medialayer-video/live/" style="width:100%;height:500px"></iframe>

### Temporales

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/layers-imagery-afrenderer/live/" style="width:100%;height:500px"></iframe>

### Multidimensionales

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/layers-voxel-slices/live/" style="width:100%;height:500px"></iframe>

### Simulaciones

<iframe src="https://developers.arcgis.com/javascript/latest/sample-code/scene-weather/live/" style="width:100%;height:500px"></iframe>

:::

::: {.notes}
datos multidimensionales
Voxel
::: -->


# Thanks!{.center-title-slide}

::: {.center-xy}
[x.com/hhkaos](https://x.com/hhkaos) | [github.com/hhkaos/ppt-dataviz/](https://hhkaos.github.io/ppt-dataviz/)

<!-- ![](./imgs/thematic-mapping.png) -->

{{< video ./video/flooding-arcgis-google-photorealistic-tiles.mp4 width="540" >}}

Author: [Miroslav Umlauf](https://www.linkedin.com/posts/mumlauf_it-is-amazing-to-watch-esri-pushing-arcgis-activity-7169932169384058880-8JIy/)
:::